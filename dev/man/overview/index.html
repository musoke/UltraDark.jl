<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Overview · UltraDark.jl</title><meta name="title" content="Overview · UltraDark.jl"/><meta property="og:title" content="Overview · UltraDark.jl"/><meta property="twitter:title" content="Overview · UltraDark.jl"/><meta name="description" content="Documentation for UltraDark.jl."/><meta property="og:description" content="Documentation for UltraDark.jl."/><meta property="twitter:description" content="Documentation for UltraDark.jl."/><meta property="og:url" content="https://musoke.github.io/UltraDark.jl/man/overview/"/><meta property="twitter:url" content="https://musoke.github.io/UltraDark.jl/man/overview/"/><link rel="canonical" href="https://musoke.github.io/UltraDark.jl/man/overview/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">UltraDark.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../install/">Installation</a></li><li class="is-active"><a class="tocitem" href>Overview</a></li><li><a class="tocitem" href="../init/">Soliton Initialisation</a></li><li><a class="tocitem" href="../output/">Output Configuration</a></li><li><a class="tocitem" href="../config/">Simulation Configuration</a></li><li><a class="tocitem" href="../summary/">Summary Statistics</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Overview</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Overview</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/musoke/UltraDark.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/musoke/UltraDark.jl/blob/main/docs/src/man/overview.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h1><p>This page is a brief overview of how to use UltraDark. Other examples go into more detail.</p><p>UltraDark is built around <a href="../../api/#UltraDark.AbstractGrids"><code>UltraDark.AbstractGrids</code></a> objects that contain coordinates and fields, and keep track of the relations between them. There are two types of grids included with UltraDark. <a href="../../api/#UltraDark.Grids"><code>UltraDark.Grids</code></a> are built around regular Julia <a href="https://docs.julialang.org/en/v1/base/arrays/#Core.Array"><code>Core.Array</code></a>s. These are the grids used in most of the examples in this documentation. <a href="../../api/#UltraDark.PencilGrids"><code>UltraDark.PencilGrids</code></a> is built around <a href="https://jipolanco.github.io/PencilArrays.jl/dev/PencilArrays/#PencilArrays.PencilArray"><code>PencilArrays.PencilArray</code></a> and <a href="https://jipolanco.github.io/PencilFFTs.jl/dev/PencilFFTs/"><code>PencilFFTs</code></a>. <code>PencilGrids</code> are useful for taking advantage of MPI parallelism when running in a cluster environment.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Note that there is significant overhead involved in using <a href="../../api/#UltraDark.PencilGrids"><code>PencilGrids</code></a>. It is best to stick to <a href="../../api/#UltraDark.Grids"><code>Grids</code></a> unless you are running jobs accross multiple nodes.</p></div></div><p>You can define your own subtype of <a href="../../api/#UltraDark.AbstractGrids"><code>UltraDark.AbstractGrids</code></a> if you wish to take advantage of other forms of parallelism or change the dynamics of the fields.</p><p>Let&#39;s start by creating a <a href="../../api/#UltraDark.Grids"><code>Grids</code></a> object.</p><pre><code class="language-julia hljs">using UltraDark

const resol = 64
const box_length = 10.0

grids = Grids(box_length, resol);</code></pre><p><code>grids</code> is initially empty, as we can see by checking its mass</p><pre><code class="language-julia hljs">UltraDark.update_gravitational_potential!(grids) # ensure the density is up to date
UltraDark.mass(grids)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0</code></pre><p>Initial conditions are set by modifying the field <code>ψx</code> of <code>grids</code>. Let&#39;s use <a href="../init/#UltraDark.Initialise.add_fdm_soliton!-Tuple{UltraDark.AbstractGrids, Vararg{Any, 5}}"><code>UltraDark.Initialise.add_fdm_soliton!</code></a> to add a soliton with nonzero velocity to the center of <code>grid</code>.</p><pre><code class="language-julia hljs">const mass = 10
const position0 = [0, 0, 0]
const velocity = [1, 0, 0]
const phase = 0
const t0 = 0

UltraDark.Initialise.add_fdm_soliton!(grids, mass, position0, velocity, phase, t0)</code></pre><p>Now, as expected, the mass on <code>grids</code> is nonzero</p><pre><code class="language-julia hljs">UltraDark.update_gravitational_potential!(grids) # ensure the density is up to date
UltraDark.mass(grids)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">9.999133748767056</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This does not exactly equal <code>mass</code> because we have used a coarse grid.</p></div></div><p>Let&#39;s also check the location of the soliton.</p><pre><code class="language-julia hljs">argmax(grids.ρx)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CartesianIndex(32, 32, 32)</code></pre><p>The indices of the maximum are at half <code>resol</code> in each dimension; this is the center of the box.</p><p>After creating a <a href="../../api/#UltraDark.AbstractGrids"><code>AbstractGrids</code></a> on which a simulation will happen and adding some matter to it, one must specify how the simulation should be carried out. The most important details are when and where to write output, and when the simulation should end.</p><pre><code class="language-julia hljs">const output_times = 0:0.5:2
const output_dir = joinpath(mktempdir(), &quot;output&quot;)
output_config = OutputConfig(output_dir, output_times; box = true)</code></pre><p>See <a href="../output/#UltraDark.Output.OutputConfig"><code>UltraDark.Output.OutputConfig</code></a> for more details of how to configure the output and <a href="../config/#UltraDark.Config.SimulationConfig"><code>UltraDark.Config.SimulationConfig</code></a> to configure other aspects of the simulation.</p><p>Now we are ready to run a simulation by calling <a href="../../api/#UltraDark.simulate!-Tuple{Any, OutputConfig}"><code>simulate!</code></a>. Running this line will likely take some time, especially if UltraDark.jl has not been precompiled by your Julia installation.</p><pre><code class="language-julia hljs">@time simulate!(grids, output_config)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Reached time 0.5000000000000002
[ Info: Reached time 1.0
[ Info: Reached time 1.5000000000000009
[ Info: Reached time 2.0
  4.064064 seconds (40.19 k allocations: 746.612 MiB, 6.08% gc time, 0.90% compilation time)</code></pre><p>We initialised the soliton with a nonzero <code>velocity</code>. Let&#39;s check if the soliton moved during the simulation.</p><pre><code class="language-julia hljs">argmax(grids.ρx)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">CartesianIndex(45, 33, 33)</code></pre><p>Yes, it did – the maximum is now at a different location.</p><p>We can also check this by loading output files from <code>output_dir</code> and plotting them.</p><pre><code class="language-julia hljs">using CairoMakie
using LaTeXStrings
using NPZ

fig = Figure()

for (i, t_index) in enumerate([1, length(output_times)])
    rho= npzread(joinpath(output_dir, &quot;rho_$(t_index).npy&quot;))
    ax = Axis(fig[1, i], title=L&quot;$t = %$(output_times[t_index])$&quot;, aspect=DataAspect())
    heatmap!(grids.x[:, 1, 1], grids.y[1, :, 1], rho[:, :, Int(resol//2)])
end
fig</code></pre><p><img src="../overview.png" alt/></p><p>After understanding this overview you may want to browse the <a href="https://github.com/musoke/UltraDark.jl/tree/main/examples">example notebooks</a> to see more complex simulations and analysis.</p><p>Please <a href="https://github.com/musoke/UltraDark.jl/issues/new">open an issue</a> if you run into problems or have feature requests.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../install/">« Installation</a><a class="docs-footer-nextpage" href="../init/">Soliton Initialisation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 7 May 2024 18:20">Tuesday 7 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
